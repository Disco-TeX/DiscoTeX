<!DOCTYPE html>
<html lang="en">
<head>
<title>DiscoTeX Compiler</title>

<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta charset="UTF-8" />

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

<link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

<!-- MathJax -->
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- DiscoTeX -->
<script type="text/javascript" src="src/compiler/catcode.js"></script>
<script type="text/javascript" src="src/compiler/Stream.js"></script>
<script type="text/javascript" src="src/compiler/State.js"></script>
<script type="text/javascript" src="src/compiler/Parser.js"></script>
<script type="text/javascript" src="src/compiler/TeX.js"></script>
<script type="text/javascript" src="src/compiler/DiscoTeX.js"></script>
<script type="text/javascript" src="src/compiler/LaTeX.js"></script>


<script>
window.onload = function(){
    $('#in-link a').click(function (e) {
            e.preventDefault()
            $(this).tab('show')
            });
    $('#err-link a').click(function (e) {
            e.preventDefault()
            $(this).tab('show')
            });
    $('#warn-link a').click(function (e) {
            e.preventDefault()
            $(this).tab('show')
            });
    $('#out-link a').click(function (e) {
            e.preventDefault()
            $(this).tab('show')
            });
}

compile = function(file){
    $.ajaxSetup({ cache: false });

    $.ajax({
type: 'GET',
async: true,
timeout: 5000,
url: file,
success: function(data, textStatus, request){
var start = new Date().getTime();
var modDate  = new Date(request.getResponseHeader('Last-Modified'));
var parser = new DiscoTeX.Parser(data, modDate);
var html = parser.parse();
var end = new Date().getTime();

var ewlog = parser.getErrorLog();
ewlog = ewlog.concat(parser.getWarningLog());

//ewlog.concat(parser.getWarningLog());

ewlog.sort(function(x, y){ return x.line > y.line; });

$('#err-link span.badge').text(ewlog.length !== 0 ? ewlog.length : '');
$('#err-tab').text(ewlog);
var ewlogString = '';
ewlog.forEach(function(el){
        ewlogString += '<tr class="' + el.type + '"><td align="right"><strong>' + el.line + '</strong></td><td>' + el.message + '</td></tr>';
    });

ewlogString = '<br/><div class="row"><div class="col-md-10 col-md-offset-1"><table class="table table-hover"><thead><th>Line:</th><th>Message:</th></thead></thead>' + ewlogString + '</table></div></div>';
$('#err-tab').html(ewlogString);

$('#output').text(html);


$('#execTime').text('Compilation time: ' + ((end - start) / 1000) + ' seconds');
}

});
}
</script>
<style type="text/css">
nav, pre{
    margin-top: 1em;
}
</style>
</head>
<body>

<div class="container">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">DiscoTeX</a>
            </div>
        </div>
    </nav>

    <ul class="nav nav-tabs">
        <li role="presentation" id="in-link" class="active"aria-controls="" role="tab" data-toggle="tab"><a href="#in-tab" aria-controls="input" role="tab" data-toggle="tab">Input</a></li>
        <li role="presentation" id="err-link"><a href="#err-tab" aria-controls="err" role="tab" data-toggle="tab">Errors/Warnings <span class="badge"></span></a></li>
        <li role="presentation" id="out-link"><a href="#out-tab" aria-controls="out" role="tab" data-toggle="tab">Output</a></li>
        <li role="presentation" class="pull-right navbar-text" id="execTime"></li>
    </ul>

    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="in-tab">
            <br/>
            <button onclick="compile('test2.tex');" class="btn btn-primary">Compile</button>
        </div>
        <div role="tabpanel" class="tab-pane" id="err-tab"></div>
        <div role="tabpanel" class="tab-pane" id="out-tab">
            <pre id="output"></pre>
        </div>
    </div>
</div>

<!--<textarea id="output" rows = "20", cols="40"></textarea>

</body>
</html>
